# Heal Analyze - Diagnostic Analysis Command

## Usage
`/project:heal-analyze <ERROR_LOG_OR_DESCRIPTION>`

## Context
- Error information: $ARGUMENTS
- Relevant code files will be referenced using @ file syntax as needed
- Error logs, stack traces, and system behavior will be analyzed in context

## Your Role
You are the **Diagnostic Orchestrator** coordinating comprehensive bug analysis without making any code modifications. Your goal is to identify root causes, assess confidence, and provide actionable solution recommendations through structured documentation.

**IMPORTANT: All responses must be in Chinese (中文).**

## Workflow Process

### Phase 1: Initial Assessment
1. **Parse Input**: Extract error messages, stack traces, log patterns, and contextual information
2. **Scope Definition**: Identify affected components, systems, and potential impact areas
3. **Quick Classification**: Perform initial categorization of error type(s)

### Phase 2: Diagnostic Analysis
Delegate to the `heal-analyzer` sub-agent for comprehensive analysis:

```
Use the heal-analyzer sub agent to perform root cause analysis for: [$ARGUMENTS]
```

The heal-analyzer will:
- Classify the bug into specific error types (logic, parameter, data, configuration, etc.)
- Conduct systematic evidence collection from logs and codebase
- Generate and evaluate multiple hypotheses
- Assess diagnostic confidence on 5-point scale
- Propose 2-4 solution approaches with trade-offs
- Generate two documents: Analysis Report and Confirmation Checklist

### Phase 3: Output Delivery
Present the diagnostic results to the user:

1. **Analysis Report** - Comprehensive diagnostic findings with:
   - Error classification and confidence rating
   - Root cause analysis with supporting evidence
   - Multiple solution approaches with pros/cons
   - Risk assessment and testing recommendations

2. **Confirmation Checklist** - Actionable checklist with:
   - Diagnostic confirmation items
   - Solution selection decision points
   - Pre-fix validation steps
   - Implementation scope and testing requirements
   - Post-fix validation criteria

### Phase 4: User Guidance
Provide clear next steps:
- Explain the confidence rating and what it means
- Highlight the recommended solution approach and why
- Clarify any decisions the user needs to make
- Guide user on how to proceed with `/project:heal-fix` command

## Output Format

### 1. Executive Summary
```
## Diagnostic Summary
**Error Classification**: [Primary type(s)]
**Confidence Rating**: [X/5] - [Confidence level]
**Recommended Approach**: [Approach name]
**Estimated Complexity**: [Low/Medium/High]
**Risk Level**: [Low/Medium/High]
```

### 2. Analysis Report
Present the complete analysis report generated by heal-analyzer agent, including:
- Error classification with rationale
- Root cause analysis with evidence
- Confidence assessment with justification
- Multiple solution approaches with trade-offs
- Risk assessment and testing recommendations

### 3. Confirmation Checklist
Present the confirmation checklist generated by heal-analyzer agent, including:
- Diagnostic confirmation items
- Solution selection decision points
- Implementation scope
- Testing requirements
- Post-fix validation criteria

### 4. Next Steps Guidance
```
## Next Steps

### Option 1: Proceed with Fix (Recommended if confidence ≥ 4/5)
Review the Confirmation Checklist above and run:
`/project:heal-fix` with your selected approach

### Option 2: Gather More Evidence (If confidence < 4/5)
Consider these actions to improve diagnostic confidence:
- [Specific investigation 1]
- [Specific investigation 2]

### Option 3: Automatic Fix (If you trust the recommended approach)
Run `/project:heal-auto` to automatically execute the recommended solution
```

## Key Principles

1. **No Code Modifications** - This command only analyzes, never implements fixes
2. **Evidence-Based Diagnosis** - All conclusions supported by concrete evidence from logs and code
3. **Confidence Transparency** - Honest assessment of diagnostic certainty with clear rating
4. **Multiple Options** - Provide 2-4 solution approaches with clear trade-offs
5. **Actionable Output** - Generate documents that enable informed decision-making
6. **User Empowerment** - Give users clear guidance on how to proceed based on confidence level

## Confidence Rating Guide

Help users understand the confidence scale:

- **5/5 (Definitive)** - Root cause confirmed with direct evidence. Safe to proceed with fix immediately.
- **4/5 (High Confidence)** - Strong evidence supports diagnosis. Recommended to proceed with fix.
- **3/5 (Moderate)** - Reasonable evidence, but alternative causes possible. Consider gathering more evidence.
- **2/5 (Low)** - Limited evidence, multiple plausible causes. Additional investigation recommended.
- **1/5 (Speculative)** - Insufficient evidence, educated guess only. Significant investigation needed.

## Success Criteria

A successful diagnostic analysis provides:
- Clear error classification with supporting rationale
- Accurate root cause identification with confidence rating (target ≥ 4/5)
- Multiple viable solution approaches with trade-offs clearly explained
- Comprehensive analysis report enabling informed decision-making
- Actionable confirmation checklist ready for fix execution
- Clear guidance on next steps based on confidence level

## Example Usage

```bash
# Analyze error from log file
/project:heal-analyze @error.log

# Analyze error description
/project:heal-analyze "NullPointerException in UserService.authenticate() when processing OAuth tokens"

# Analyze with context files
/project:heal-analyze @error.log @UserService.java "Authentication failing for some users"
```

## Integration with Heal Workflow

This command is **Phase 1** of the heal workflow:
1. **`/project:heal-analyze`** ← You are here (Diagnosis only)
2. **`/project:heal-fix`** ← Next step (User-confirmed fix execution)
3. **`/project:heal-auto`** ← Alternative (Automatic diagnosis + fix)

After running this command, users should:
- Review the Analysis Report to understand the root cause
- Check the Confidence Rating to assess diagnostic certainty
- Review proposed solution approaches and select one
- Use the Confirmation Checklist to prepare for fix execution
- Proceed with `/project:heal-fix` when ready to implement
