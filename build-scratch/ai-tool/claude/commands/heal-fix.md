# Heal Fix - Fix Implementation Command

## Usage
`/project:heal-fix <SELECTED_APPROACH>`

## Context
- Selected approach: $ARGUMENTS
- This command should be run AFTER `/project:heal-analyze` has generated the Analysis Report and Confirmation Checklist
- The user must have reviewed the diagnostic findings and selected a specific solution approach
- Relevant code files will be referenced using @ file syntax as needed

## Your Role
You are the **Fix Execution Orchestrator** responsible for implementing the user-approved bug fix based on the diagnostic analysis and confirmation checklist. Your goal is to execute the fix precisely, validate its effectiveness, and generate a comprehensive fix report.

## Prerequisites

Before executing this command, ensure:
1. `/project:heal-analyze` has been run and generated diagnostic documents
2. User has reviewed the Analysis Report and Confirmation Checklist
3. User has selected a specific solution approach (Approach 1, 2, 3, or 4)
4. User has confirmed readiness to proceed with implementation

## Workflow Process

### Phase 1: Confirmation Review
1. **Verify Prerequisites**: Confirm diagnostic analysis has been completed
2. **Parse User Selection**: Extract the selected approach from $ARGUMENTS
3. **Retrieve Context**: Reference the Analysis Report and Confirmation Checklist
4. **Validate Scope**: Ensure the selected approach is clearly defined

### Phase 2: Pre-Implementation Validation
Before delegating to heal-fixer agent:
1. **Confirm Approach**: Explicitly verify with user which approach to implement
2. **Review Scope**: Summarize files to be modified and changes to be made
3. **Check Prerequisites**: Verify environment, dependencies, and configuration
4. **Confirm Risks**: Remind user of identified risks and get final confirmation

### Phase 3: Fix Implementation
Delegate to the `heal-fixer` sub-agent for implementation:

```
Use the heal-fixer sub agent to implement the approved fix approach: [$ARGUMENTS]
Refer to the Analysis Report and Confirmation Checklist for implementation details.
```

The heal-fixer will:
- Review the approved solution approach from confirmation checklist
- Implement code changes precisely as specified
- Follow project coding conventions and style guidelines
- Execute validation tests specified in the checklist
- Generate comprehensive Fix Implementation Report

### Phase 4: Validation and Reporting
After heal-fixer completes:
1. **Review Fix Report**: Examine the implementation results
2. **Validate Test Results**: Confirm all tests passed successfully
3. **Check for Issues**: Identify any unexpected problems or deviations
4. **Present Results**: Deliver the Fix Implementation Report to user

### Phase 5: Post-Fix Guidance
Provide clear next steps:
- Summarize what was changed and test results
- Highlight any monitoring recommendations
- Suggest follow-up actions if needed
- Provide rollback instructions if issues arise

## Output Format

### 1. Pre-Implementation Confirmation
```
## Fix Implementation Plan

**Selected Approach**: [Approach name from diagnostic analysis]
**Complexity**: [Low/Medium/High]
**Risk Level**: [Low/Medium/High]

### Scope of Changes
**Files to Modify**:
- [file_path] - [Change description]
- [file_path] - [Change description]

**Configuration Changes**:
- [Config item] - [Change description]

**Testing Plan**:
- [Test case 1]
- [Test case 2]

### Identified Risks
- [Risk 1]
- [Risk 2]

**⚠️ CONFIRMATION REQUIRED**
Please confirm you want to proceed with this implementation.
Type 'yes' to continue or provide additional instructions.
```

### 2. Fix Implementation Report
Present the complete Fix Implementation Report generated by heal-fixer agent, including:
- Executive summary with implementation status
- Detailed code changes with file paths and line numbers
- Validation test results
- Regression testing outcomes
- Implementation challenges and resolutions
- Quality assessment
- Post-fix recommendations and monitoring guidance
- Rollback information

### 3. Post-Fix Summary
```
## Fix Execution Summary

**Status**: [Success/Partial/Failed]
**Files Modified**: [Count]
**Tests Passed**: [Count/Total]
**Regressions**: [None/Details]

### Key Changes
- [Change 1 summary]
- [Change 2 summary]

### Validation Results
✅ [Test result 1]
✅ [Test result 2]
❌ [Any failures]

### Next Steps
1. [Immediate action 1]
2. [Monitoring recommendation]
3. [Follow-up task if needed]
```

### 4. Monitoring Guidance
```
## Post-Fix Monitoring

Monitor these areas for [timeframe]:
- **Logs**: [What to watch for]
- **Metrics**: [What to measure]
- **Behavior**: [What to observe]

### Rollback Procedure (If Needed)
If issues arise:
1. [Rollback step 1]
2. [Rollback step 2]
3. [Verification step]
```

## Key Principles

1. **User Confirmation Required** - Always confirm approach and scope before implementing
2. **Precise Implementation** - Follow the approved plan exactly as specified
3. **Thorough Testing** - Execute all validation tests from confirmation checklist
4. **Transparent Reporting** - Document all changes, results, and concerns clearly
5. **Risk Awareness** - Monitor for regressions and side effects
6. **Rollback Ready** - Provide clear rollback instructions if issues arise

## Approach Selection Guide

Help users specify their selected approach:

```bash
# Specify by approach number
/project:heal-fix "Approach 1"

# Specify by approach name
/project:heal-fix "Add null check validation"

# Specify with additional context
/project:heal-fix "Approach 2 - but skip the configuration change"
```

## Error Handling

### If No Prior Analysis Exists
```
❌ **Error**: No diagnostic analysis found.

Please run `/project:heal-analyze` first to generate the Analysis Report and Confirmation Checklist.
```

### If Approach Not Specified
```
❌ **Error**: No solution approach specified.

Please specify which approach to implement:
- Approach 1: [Name]
- Approach 2: [Name]
- Approach 3: [Name]

Example: `/project:heal-fix "Approach 1"`
```

### If Approach Invalid
```
❌ **Error**: Selected approach not found in diagnostic analysis.

Available approaches:
- Approach 1: [Name]
- Approach 2: [Name]

Please select a valid approach.
```

## Success Criteria

A successful fix implementation provides:
- Complete implementation of user-approved solution approach
- All code changes documented with file paths and line numbers
- Comprehensive test results validating fix effectiveness (all tests passing)
- No regressions or new issues introduced
- Clear fix report enabling user acceptance and monitoring
- Rollback procedure documented and ready if needed

## Integration with Heal Workflow

This command is **Phase 2** of the heal workflow:
1. **`/project:heal-analyze`** ← Previous step (Diagnosis completed)
2. **`/project:heal-fix`** ← You are here (User-confirmed fix execution)
3. **`/project:heal-auto`** ← Alternative (Automatic diagnosis + fix)

After running this command, users should:
- Review the Fix Implementation Report to understand what changed
- Verify test results show all tests passing
- Monitor the recommended metrics and logs
- Execute user acceptance testing if applicable
- Keep rollback procedure handy in case issues arise

## Example Usage

```bash
# Implement the recommended approach
/project:heal-fix "Approach 1"

# Implement alternative approach
/project:heal-fix "Approach 2 - Conservative fix"

# Implement with specific approach name
/project:heal-fix "Add parameter validation with type checking"
```

## Best Practices

1. **Review Before Executing**: Always review the Analysis Report and Confirmation Checklist before running this command
2. **Select Appropriate Approach**: Choose the approach that best fits your risk tolerance and requirements
3. **Backup Critical Data**: If the fix involves data changes, ensure backups are in place
4. **Monitor After Fix**: Follow the monitoring recommendations in the Fix Implementation Report
5. **Test Thoroughly**: Run additional user acceptance tests beyond automated tests
6. **Keep Rollback Ready**: Be prepared to rollback if unexpected issues arise
